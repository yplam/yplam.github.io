<!DOCTYPE html>
<html lang="zh-cn" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Flutter GenUI 初探 | YPLAM</title>
<meta name="keywords" content="MachineLearning, Flutter">
<meta name="description" content="Flutter 官方最近发布了 GenUI SDK for Flutter , 其理念就是通过 GenUI SDK 作为编排层，将用户与 AI Agent 间的交互从文本转变为丰富的交互式UI。">
<meta name="author" content="">
<link rel="canonical" href="https://yplam.com/posts/machinelearning/flutter-genui/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.45e9646c1d4a681ebbffe4c0f5bdd79d96646d99daf08cf8a3488605487f2ba1.css" integrity="sha256-RelkbB1KaB67/&#43;TA9b3XnZZkbZna8Iz4o0iGBUh/K6E=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://yplam.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://yplam.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://yplam.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://yplam.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://yplam.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh-cn" href="https://yplam.com/posts/machinelearning/flutter-genui/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-960JLZS3KY"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-960JLZS3KY');
        }
      </script><meta property="og:url" content="https://yplam.com/posts/machinelearning/flutter-genui/">
  <meta property="og:site_name" content="YPLAM">
  <meta property="og:title" content="Flutter GenUI 初探">
  <meta property="og:description" content="Flutter 官方最近发布了 GenUI SDK for Flutter , 其理念就是通过 GenUI SDK 作为编排层，将用户与 AI Agent 间的交互从文本转变为丰富的交互式UI。">
  <meta property="og:locale" content="zh-cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-12-03T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-12-03T00:00:00+00:00">
    <meta property="article:tag" content="MachineLearning">
    <meta property="article:tag" content="Flutter">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Flutter GenUI 初探">
<meta name="twitter:description" content="Flutter 官方最近发布了 GenUI SDK for Flutter , 其理念就是通过 GenUI SDK 作为编排层，将用户与 AI Agent 间的交互从文本转变为丰富的交互式UI。">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://yplam.com/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Flutter GenUI 初探",
      "item": "https://yplam.com/posts/machinelearning/flutter-genui/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Flutter GenUI 初探",
  "name": "Flutter GenUI 初探",
  "description": "Flutter 官方最近发布了 GenUI SDK for Flutter , 其理念就是通过 GenUI SDK 作为编排层，将用户与 AI Agent 间的交互从文本转变为丰富的交互式UI。\n",
  "keywords": [
    "MachineLearning", "Flutter"
  ],
  "articleBody": "Flutter 官方最近发布了 GenUI SDK for Flutter , 其理念就是通过 GenUI SDK 作为编排层，将用户与 AI Agent 间的交互从文本转变为丰富的交互式UI。\nGenUI 如何工作？ GenUI 由多个组件组成：\nGenUiConversation： GenUI 的主要交互入口。它包含 GenUiManager 和 ContentGenerator 类，管理对话历史记录，并协调整个生成式 UI 流程。 Catalog： CatalogItem 对象集合，定义了 AI 可以使用的组件集。每个 CatalogItem 都指定一个组件的名称（供 AI 引用）、其属性的数据模式以及用于渲染 Flutter 组件的构建器函数。 DataModel： 一个集中式的、可观察的动态 UI 状态存储。组件绑定到此模型中的数据。当数据更改时，仅重建依赖于该特定数据的组件。 ContentGenerator： 用于与生成式 AI 模型通信的接口。此接口使用流将 A2uiMessage 命令、文本响应和错误发送回 GenUiConversation。 A2uiMessage： AI（通过内容生成器）向 UI 发送的消息，指示 UI 执行诸如 beginRendering、surfaceUpdate、dataModelUpdate 或 deleteSurface 之类的操作。 其基础流程就是，开发者通过 CatalogItem 定义一些 UI 组件，每一个 UI 组件 包含以下主要元素：\nname: CatalogItem 名称，在 json 返回时会用出字段作为 key dataSchema： 通过 json schema 描述的组件状态数据结构 widgetBuilder： 如何基于模型根据 dataSchema 格式返回的数据来渲染组件 可选的 example ContentGenerator 在发送请求到后端 LLM API 时，会将开发者定义的 CatalogItem 列表作为 surfaceUpdate function call 的参数定义，同时发送到后端。LLM 通过 functionCall 的方式调用 surfaceUpdate 来更新、定义 UI 组件以及状态，然后通过 beginRendering 的 functionCall 来触发 GenUiManager 渲染界面。而其中用到的数据结构就是 A2uiMessage。而用户在 UI 界面上的交互也会用 UserMessage 的方式将组件状态数据上报。\n其中的关键是，GenUI SDK 并不仅仅是预定义若干固定的 UI 组件，而是尝试让 LLM 通过组合 UI 组件的方式去生成复杂的用户交互 UI。而其中的挑战是如何通过有限的 System Prompt 来让 LLM 根据需要组合出稳定可用的交互 UI，根据用户的交互确定用户目标。\nGenUI 基础功能测试 GenUI SDK 提供 18 个预定义的 CoreCatalogItems：\nstatic Catalog asCatalog() { return Catalog([ audioPlayer, button, card, checkBox, column, dateTimeInput, divider, icon, image, list, modal, multipleChoice, row, slider, tabs, text, textField, video, ]); } 然而初步测试下来，虽然已经在 System Prompt 上做了不少控制，也难以使用 gemini-2.5-flash 模型生成稳定可用的 UI，特别是 button、textField 等用户交互类组件。因此只使用几个简单的展示类组件，以及自己编写一个代码高亮组件供 GenUI 使用：\nfinal appCatalog = Catalog([ CoreCatalogItems.column, CoreCatalogItems.text, codeCatalogItem, ]); 参考官方教程 Get started with the GenUI SDK for Flutter , 对于国内用户需要实现自己的 GoogleGenerativeServiceInterface 来解决网络问题。目标是在 CycBox 中集成 AI 根据用户需求生成配置文件与 Lua 脚本功能。\nCycBox Chatbot 效果截图：\n总体而言， LLM 基本能理解用户意图生成可交互的组件组合，而由于 GenUiManager 帮忙接管了 UI 渲染，的确使得 AI Agent 的交互编程变得非常简单。\nGenUI SDK 后端 API 请求与响应 最后，通过对 GenUI SDK 接口请求与响应数据的抓包，可以更直观地看到以上交互是如何实现的：\n发送请求，带上组件定义：\n{ \"contents\": [ { \"parts\": [ { \"text\": \"You are a CycBox IoT debugging assistant specializing in Lua script generation. SystemPromptRemoved\" } ] }, { \"parts\": [ { \"text\": \"Could you help me debug PMS9103M Air Quality Sensor?\" } ], \"role\": \"user\" } ], \"model\": \"models/gemini-2.5-flash\", \"toolConfig\": { \"functionCallingConfig\": { \"allowedFunctionNames\": [ \"surfaceUpdate\", \"beginRendering\", \"provideFinalOutput\" ], \"mode\": \"ANY\" } }, \"tools\": [ { \"functionDeclarations\": [ { \"description\": \"Updates a surface with a new set of components.\", \"name\": \"surfaceUpdate\", \"parameters\": { \"properties\": { \"components\": { \"description\": \"A list of component definitions.\", \"items\": { \"description\": \"Represents a *single* component in a UI widget tree. This component could be one of many supported types.\", \"properties\": { \"component\": { \"description\": \"A wrapper object that MUST contain exactly one key, which is the name of the component type (e.g., 'Heading'). The value is an object containing the properties for that specific component.\", \"properties\": { \"Code\": { \"properties\": { \"code\": { \"description\": \"The source code to display\", \"type\": \"STRING\" }, \"filename\": { \"description\": \"Optional filename or description to display as header\", \"type\": \"STRING\" }, \"language\": { \"description\": \"Programming language for syntax highlighting\", \"enum\": [ \"dart\", \"lua\", \"yaml\", \"javascript\", \"python\", \"json\", \"bash\", \"c\", \"cpp\", \"java\", \"rust\", \"go\" ], \"type\": \"STRING\" } }, \"required\": [ \"code\", \"language\" ], \"type\": \"OBJECT\" }, \"Column\": { \"properties\": { \"alignment\": { \"description\": \"How children are aligned on the cross axis. \", \"enum\": [ \"start\", \"center\", \"end\", \"stretch\", \"baseline\" ], \"type\": \"STRING\" }, \"children\": { \"description\": \"Either an explicit list of widget IDs for the children, or a template with a data binding to the list of children.\", \"properties\": { \"explicitList\": { \"items\": { \"type\": \"STRING\" }, \"type\": \"ARRAY\" }, \"template\": { \"properties\": { \"componentId\": { \"type\": \"STRING\" }, \"dataBinding\": { \"type\": \"STRING\" } }, \"required\": [ \"componentId\", \"dataBinding\" ], \"type\": \"OBJECT\" } }, \"type\": \"OBJECT\" }, \"distribution\": { \"description\": \"How children are aligned on the main axis. \", \"enum\": [ \"start\", \"center\", \"end\", \"spaceBetween\", \"spaceAround\", \"spaceEvenly\" ], \"type\": \"STRING\" } }, \"type\": \"OBJECT\" }, \"Text\": { \"properties\": { \"text\": { \"description\": \"While simple Markdown is supported (without HTML or image references), utilizing dedicated UI components is generally preferred for a richer and more structured presentation.\", \"properties\": { \"literalString\": { \"type\": \"STRING\" }, \"path\": { \"description\": \"A relative or absolute path in the data model.\", \"type\": \"STRING\" } }, \"type\": \"OBJECT\" }, \"usageHint\": { \"description\": \"A usage hint for the base text style.\", \"enum\": [ \"h1\", \"h2\", \"h3\", \"h4\", \"h5\", \"caption\", \"body\" ], \"type\": \"STRING\" } }, \"required\": [ \"text\" ], \"type\": \"OBJECT\" } }, \"type\": \"OBJECT\" }, \"id\": { \"type\": \"STRING\" }, \"weight\": { \"description\": \"Optional layout weight for use in Row/Column children.\", \"type\": \"INTEGER\" } }, \"required\": [ \"id\", \"component\" ], \"type\": \"OBJECT\" }, \"type\": \"ARRAY\" }, \"surfaceId\": { \"description\": \"The unique identifier for the UI surface to create or update. If you are adding a new surface this *must* be a new, unique identified that has never been used for any existing surfaces shown.\", \"type\": \"STRING\" } }, \"required\": [ \"surfaceId\", \"components\" ], \"type\": \"OBJECT\" } }, { \"description\": \"Signals the client to begin rendering a surface with a root component.\", \"name\": \"beginRendering\", \"parameters\": { \"properties\": { \"root\": { \"description\": \"The ID of the root widget. This ID must correspond to the ID of one of the widgets in the `components` list.\", \"type\": \"STRING\" }, \"surfaceId\": { \"description\": \"The unique identifier for the UI surface to render.\", \"type\": \"STRING\" } }, \"required\": [ \"surfaceId\", \"root\" ], \"type\": \"OBJECT\" } }, { \"description\": \"Returns the final output. Call this function when you are done with the current turn of the conversation. Do not call this if you need to use other tools first. You MUST call this tool when you are done.\", \"name\": \"provideFinalOutput\", \"parameters\": { \"properties\": { \"output\": { \"properties\": { \"response\": { \"type\": \"STRING\" } }, \"type\": \"OBJECT\" } }, \"type\": \"OBJECT\" } } ] } ] } LLM 返回响应，返回交互信息，实际上就是两个 functionCall， 包括 surfaceUpdate 与 beginRendering ，这个需要在 System Prompt 中详细说明，不然 LLM 可能无法生成正确的 UI 组件结构：\n{ \"candidates\": [ { \"content\": { \"parts\": [ { \"functionCall\": { \"args\": { \"components\": [ { \"component\": { \"Text\": { \"text\": { \"literalString\": \"I can help you debug your PMS9103M Air Quality Sensor. To get started, please provide the following information:\" }, \"usageHint\": \"h3\" } }, \"id\": \"intro_text\" }, { \"component\": { \"Text\": { \"text\": { \"literalString\": \"1. Do you have the sensor's datasheet or protocol documentation available? This will help me understand the message structure.\" }, \"usageHint\": \"body\" } }, \"id\": \"question_1\" }, { \"component\": { \"Text\": { \"text\": { \"literalString\": \"2. How is the sensor connected to your system (e.g., Serial, USB-to-Serial, etc.)? What are the serial port parameters (baud rate, data bits, parity, stop bits, flow control)?\" }, \"usageHint\": \"body\" } }, \"id\": \"question_2\" }, { \"component\": { \"Text\": { \"text\": { \"literalString\": \"3. Can you provide any sample raw data (in hexadecimal format, if possible) that the sensor is sending?\" }, \"usageHint\": \"body\" } }, \"id\": \"question_3\" }, { \"component\": { \"Text\": { \"text\": { \"literalString\": \"4. What specific values or measurements do you want to extract from the sensor's data (e.g., PM1.0, PM2.5, PM10 concentrations)?\" }, \"usageHint\": \"body\" } }, \"id\": \"question_4\" }, { \"component\": { \"Column\": { \"children\": { \"explicitList\": [ \"intro_text\", \"question_1\", \"question_2\", \"question_3\", \"question_4\" ] } } }, \"id\": \"main_column\" } ], \"surfaceId\": \"pms9103m_debug\" }, \"name\": \"surfaceUpdate\" }, \"thoughtSignature\": \"removed\" }, { \"functionCall\": { \"args\": { \"root\": \"main_column\", \"surfaceId\": \"pms9103m_debug\" }, \"name\": \"beginRendering\" } } ], \"role\": \"model\" }, \"finishMessage\": \"Model generated function call(s).\", \"finishReason\": \"STOP\", \"index\": 0 } ], \"modelVersion\": \"gemini-2.5-flash\", \"responseId\": \"B-removed\", \"usageMetadata\": { \"candidatesTokenCount\": 418, \"promptTokenCount\": 5379, \"promptTokensDetails\": [ { \"modality\": \"TEXT\", \"tokenCount\": 5379 } ], \"thoughtsTokenCount\": 184, \"totalTokenCount\": 5981 } } Flutter 更新 UI，然后响应 functionResponse：\n{ \"contents\": [ { \"parts\": [ { \"text\": \"You are a CycBox IoT debugging assistant specializing in Lua script generation. SystemPromptRemoved\" } ] }, { \"parts\": [ { \"text\": \"Could you help me debug PMS9103M Air Quality Sensor?\" } ], \"role\": \"user\" }, { \"parts\": [ { \"functionCall\": { \"args\": { \"components\": [ { \"component\": { \"Text\": { \"text\": { \"literalString\": \"I can help you debug your PMS9103M Air Quality Sensor. To get started, please provide the following information:\" }, \"usageHint\": \"h3\" } }, \"id\": \"intro_text\" }, { \"component\": { \"Text\": { \"text\": { \"literalString\": \"1. Do you have the sensor's datasheet or protocol documentation available? This will help me understand the message structure.\" }, \"usageHint\": \"body\" } }, \"id\": \"question_1\" }, { \"component\": { \"Text\": { \"text\": { \"literalString\": \"2. How is the sensor connected to your system (e.g., Serial, USB-to-Serial, etc.)? What are the serial port parameters (baud rate, data bits, parity, stop bits, flow control)?\" }, \"usageHint\": \"body\" } }, \"id\": \"question_2\" }, { \"component\": { \"Text\": { \"text\": { \"literalString\": \"3. Can you provide any sample raw data (in hexadecimal format, if possible) that the sensor is sending?\" }, \"usageHint\": \"body\" } }, \"id\": \"question_3\" }, { \"component\": { \"Text\": { \"text\": { \"literalString\": \"4. What specific values or measurements do you want to extract from the sensor's data (e.g., PM1.0, PM2.5, PM10 concentrations)?\" }, \"usageHint\": \"body\" } }, \"id\": \"question_4\" }, { \"component\": { \"Column\": { \"children\": { \"explicitList\": [ \"intro_text\", \"question_1\", \"question_2\", \"question_3\", \"question_4\" ] } } }, \"id\": \"main_column\" } ], \"surfaceId\": \"pms9103m_debug\" }, \"name\": \"surfaceUpdate\" }, \"thoughtSignature\": \"removed\" }, { \"functionCall\": { \"args\": { \"root\": \"main_column\", \"surfaceId\": \"pms9103m_debug\" }, \"name\": \"beginRendering\" } } ], \"role\": \"model\" }, { \"parts\": [ { \"functionResponse\": { \"name\": \"surfaceUpdate\", \"response\": { \"status\": \"UI Surface pms9103m_debug updated.\", \"surfaceId\": \"pms9103m_debug\" } } }, { \"functionResponse\": { \"name\": \"beginRendering\", \"response\": { \"status\": \"Surface pms9103m_debug rendered and waiting for user input.\" } } } ], \"role\": \"user\" } ], \"model\": \"models/gemini-2.5-flash\", \"toolConfig\": { \"functionCallingConfig\": { \"allowedFunctionNames\": [ \"surfaceUpdate\", \"beginRendering\", \"provideFinalOutput\" ], \"mode\": \"ANY\" } }, \"tools\": [ { \"functionDeclarations\": [ { \"description\": \"Updates a surface with a new set of components.\", \"name\": \"surfaceUpdate\", \"parameters\": { \"properties\": { \"components\": { \"description\": \"A list of component definitions.\", \"items\": { \"description\": \"Represents a *single* component in a UI widget tree. This component could be one of many supported types.\", \"properties\": { \"component\": { \"description\": \"A wrapper object that MUST contain exactly one key, which is the name of the component type (e.g., 'Heading'). The value is an object containing the properties for that specific component.\", \"properties\": { \"Code\": { \"properties\": { \"code\": { \"description\": \"The source code to display\", \"type\": \"STRING\" }, \"filename\": { \"description\": \"Optional filename or description to display as header\", \"type\": \"STRING\" }, \"language\": { \"description\": \"Programming language for syntax highlighting\", \"enum\": [ \"dart\", \"lua\", \"yaml\", \"javascript\", \"python\", \"json\", \"bash\", \"c\", \"cpp\", \"java\", \"rust\", \"go\" ], \"type\": \"STRING\" } }, \"required\": [ \"code\", \"language\" ], \"type\": \"OBJECT\" }, \"Column\": { \"properties\": { \"alignment\": { \"description\": \"How children are aligned on the cross axis. \", \"enum\": [ \"start\", \"center\", \"end\", \"stretch\", \"baseline\" ], \"type\": \"STRING\" }, \"children\": { \"description\": \"Either an explicit list of widget IDs for the children, or a template with a data binding to the list of children.\", \"properties\": { \"explicitList\": { \"items\": { \"type\": \"STRING\" }, \"type\": \"ARRAY\" }, \"template\": { \"properties\": { \"componentId\": { \"type\": \"STRING\" }, \"dataBinding\": { \"type\": \"STRING\" } }, \"required\": [ \"componentId\", \"dataBinding\" ], \"type\": \"OBJECT\" } }, \"type\": \"OBJECT\" }, \"distribution\": { \"description\": \"How children are aligned on the main axis. \", \"enum\": [ \"start\", \"center\", \"end\", \"spaceBetween\", \"spaceAround\", \"spaceEvenly\" ], \"type\": \"STRING\" } }, \"type\": \"OBJECT\" }, \"Text\": { \"properties\": { \"text\": { \"description\": \"While simple Markdown is supported (without HTML or image references), utilizing dedicated UI components is generally preferred for a richer and more structured presentation.\", \"properties\": { \"literalString\": { \"type\": \"STRING\" }, \"path\": { \"description\": \"A relative or absolute path in the data model.\", \"type\": \"STRING\" } }, \"type\": \"OBJECT\" }, \"usageHint\": { \"description\": \"A usage hint for the base text style.\", \"enum\": [ \"h1\", \"h2\", \"h3\", \"h4\", \"h5\", \"caption\", \"body\" ], \"type\": \"STRING\" } }, \"required\": [ \"text\" ], \"type\": \"OBJECT\" } }, \"type\": \"OBJECT\" }, \"id\": { \"type\": \"STRING\" }, \"weight\": { \"description\": \"Optional layout weight for use in Row/Column children.\", \"type\": \"INTEGER\" } }, \"required\": [ \"id\", \"component\" ], \"type\": \"OBJECT\" }, \"type\": \"ARRAY\" }, \"surfaceId\": { \"description\": \"The unique identifier for the UI surface to create or update. If you are adding a new surface this *must* be a new, unique identified that has never been used for any existing surfaces shown.\", \"type\": \"STRING\" } }, \"required\": [ \"surfaceId\", \"components\" ], \"type\": \"OBJECT\" } }, { \"description\": \"Signals the client to begin rendering a surface with a root component.\", \"name\": \"beginRendering\", \"parameters\": { \"properties\": { \"root\": { \"description\": \"The ID of the root widget. This ID must correspond to the ID of one of the widgets in the `components` list.\", \"type\": \"STRING\" }, \"surfaceId\": { \"description\": \"The unique identifier for the UI surface to render.\", \"type\": \"STRING\" } }, \"required\": [ \"surfaceId\", \"root\" ], \"type\": \"OBJECT\" } }, { \"description\": \"Returns the final output. Call this function when you are done with the current turn of the conversation. Do not call this if you need to use other tools first. You MUST call this tool when you are done.\", \"name\": \"provideFinalOutput\", \"parameters\": { \"properties\": { \"output\": { \"properties\": { \"response\": { \"type\": \"STRING\" } }, \"type\": \"OBJECT\" } }, \"type\": \"OBJECT\" } } ] } ] } LLM 在接收到响应后会输出 provideFinalOutput，单个交互过程结束：\n{ \"candidates\": [ { \"content\": { \"parts\": [ { \"functionCall\": { \"args\": { \"output\": { \"response\": \"I've displayed some questions to help me understand your setup. Please provide the requested information so I can generate the appropriate CycBox configuration and Lua script.\" } }, \"name\": \"provideFinalOutput\" }, \"thoughtSignature\": \"\" } ], \"role\": \"model\" }, \"finishMessage\": \"Model generated function call(s).\", \"finishReason\": \"STOP\", \"index\": 0 } ], \"modelVersion\": \"gemini-2.5-flash\", \"responseId\": \"removed\", \"usageMetadata\": { \"candidatesTokenCount\": 49, \"promptTokenCount\": 5865, \"promptTokensDetails\": [ { \"modality\": \"TEXT\", \"tokenCount\": 5865 } ], \"thoughtsTokenCount\": 82, \"totalTokenCount\": 5996 } } 用户再次输入，请求：\n{ \"contents\": [ { \"parts\": [ { \"text\": \"You are a CycBox IoT debugging assistant specializing in Lua script generation. SystemPromptRemoved\" } ] }, { \"parts\": [ { \"text\": \"Could you help me debug PMS9103M Air Quality Sensor?\" } ], \"role\": \"user\" }, { \"parts\": [ { \"text\": \"A user interface is shown with the following content:\\n{\\\"surfaceId\\\":\\\"pms9103m_debug\\\",\\\"rootComponentId\\\":\\\"main_column\\\",\\\"components\\\":{\\\"intro_text\\\":{\\\"id\\\":\\\"intro_text\\\",\\\"component\\\":{\\\"Text\\\":{\\\"text\\\":{\\\"literalString\\\":\\\"I can help you debug your PMS9103M Air Quality Sensor. To get started, please provide the following information:\\\"},\\\"usageHint\\\":\\\"h3\\\"}}},\\\"question_1\\\":{\\\"id\\\":\\\"question_1\\\",\\\"component\\\":{\\\"Text\\\":{\\\"text\\\":{\\\"literalString\\\":\\\"1. Do you have the sensor's datasheet or protocol documentation available? This will help me understand the message structure.\\\"},\\\"usageHint\\\":\\\"body\\\"}}},\\\"question_2\\\":{\\\"id\\\":\\\"question_2\\\",\\\"component\\\":{\\\"Text\\\":{\\\"usageHint\\\":\\\"body\\\",\\\"text\\\":{\\\"literalString\\\":\\\"2. How is the sensor connected to your system (e.g., Serial, USB-to-Serial, etc.)? What are the serial port parameters (baud rate, data bits, parity, stop bits, flow control)?\\\"}}}},\\\"question_3\\\":{\\\"id\\\":\\\"question_3\\\",\\\"component\\\":{\\\"Text\\\":{\\\"text\\\":{\\\"literalString\\\":\\\"3. Can you provide any sample raw data (in hexadecimal format, if possible) that the sensor is sending?\\\"},\\\"usageHint\\\":\\\"body\\\"}}},\\\"question_4\\\":{\\\"id\\\":\\\"question_4\\\",\\\"component\\\":{\\\"Text\\\":{\\\"text\\\":{\\\"literalString\\\":\\\"4. What specific values or measurements do you want to extract from the sensor's data (e.g., PM1.0, PM2.5, PM10 concentrations)?\\\"},\\\"usageHint\\\":\\\"body\\\"}}},\\\"main_column\\\":{\\\"id\\\":\\\"main_column\\\",\\\"component\\\":{\\\"Column\\\":{\\\"children\\\":{\\\"explicitList\\\":[\\\"intro_text\\\",\\\"question_1\\\",\\\"question_2\\\",\\\"question_3\\\",\\\"question_4\\\"]}}}}}}.\" } ], \"role\": \"model\" }, { \"parts\": [ { \"text\": \"I've displayed some questions to help me understand your setup. Please provide the requested information so I can generate the appropriate CycBox configuration and Lua script.\" } ], \"role\": \"model\" }, { \"parts\": [ { \"text\": \"The sensor uses a standard UART (Serial) interface with Baud Rate: 9600 bps, Data Bits: 8, Parity: None, Stop Bits: 1, Flow Control: None\\n\\nThe data packet is **32 Bytes** long. The format is Big-Endian (High Byte first).\\n\\n\\n| Byte Index | Value/Description | Note |\\n| :--- | :--- | :--- |\\n| 0 | **0x42** | Start Character 1 (Fixed) |\\n| 1 | **0x4D** | Start Character 2 (Fixed) |\\n| 2 | Frame Length High | Fixed at 0x00 |\\n| 3 | Frame Length Low | Fixed at 0x1C (28 decimal) |\\n| 4 | **PM1.0 (Standard) High** | CF=1, Standard Particle |\\n| 5 | **PM1.0 (Standard) Low** | Unit: μg/m³ |\\n| 6 | **PM2.5 (Standard) High** | CF=1, Standard Particle |\\n| 7 | **PM2.5 (Standard) Low** | Unit: μg/m³ |\\n| 8 | **PM10 (Standard) High** | CF=1, Standard Particle |\\n| 9 | **PM10 (Standard) Low** | Unit: μg/m³ |\\n| 10 | **PM1.0 (Atmospheric) High** | **Use this for Air Quality** |\\n| 11 | **PM1.0 (Atmospheric) Low** | Unit: μg/m³ |\\n| 12 | **PM2.5 (Atmospheric) High** | **Use this for Air Quality** |\\n| 13 | **PM2.5 (Atmospheric) Low** | Unit: μg/m³ |\\n| 14 | **PM10 (Atmospheric) High** | **Use this for Air Quality** |\\n| 15 | **PM10 (Atmospheric) Low** | Unit: μg/m³ |\\n| 16-27 | Particle Counts | \u003e0.3um, \u003e0.5um, \u003e1.0um, \u003e2.5um, \u003e5.0um, \u003e10um |\\n| 28 | Version No. | |\\n| 29 | Error Code | |\\n| 30 | **Checksum High** | |\\n| 31 | **Checksum Low** | |\" } ], \"role\": \"user\" } ], \"model\": \"models/gemini-2.5-flash\", \"toolConfig\": { \"functionCallingConfig\": { \"allowedFunctionNames\": [ \"surfaceUpdate\", \"beginRendering\", \"provideFinalOutput\" ], \"mode\": \"ANY\" } }, \"tools\": [ { \"functionDeclarations\": [ { \"description\": \"Updates a surface with a new set of components.\", \"name\": \"surfaceUpdate\", \"parameters\": { \"properties\": { \"components\": { \"description\": \"A list of component definitions.\", \"items\": { \"description\": \"Represents a *single* component in a UI widget tree. This component could be one of many supported types.\", \"properties\": { \"component\": { \"description\": \"A wrapper object that MUST contain exactly one key, which is the name of the component type (e.g., 'Heading'). The value is an object containing the properties for that specific component.\", \"properties\": { \"Code\": { \"properties\": { \"code\": { \"description\": \"The source code to display\", \"type\": \"STRING\" }, \"filename\": { \"description\": \"Optional filename or description to display as header\", \"type\": \"STRING\" }, \"language\": { \"description\": \"Programming language for syntax highlighting\", \"enum\": [ \"dart\", \"lua\", \"yaml\", \"javascript\", \"python\", \"json\", \"bash\", \"c\", \"cpp\", \"java\", \"rust\", \"go\" ], \"type\": \"STRING\" } }, \"required\": [ \"code\", \"language\" ], \"type\": \"OBJECT\" }, \"Column\": { \"properties\": { \"alignment\": { \"description\": \"How children are aligned on the cross axis. \", \"enum\": [ \"start\", \"center\", \"end\", \"stretch\", \"baseline\" ], \"type\": \"STRING\" }, \"children\": { \"description\": \"Either an explicit list of widget IDs for the children, or a template with a data binding to the list of children.\", \"properties\": { \"explicitList\": { \"items\": { \"type\": \"STRING\" }, \"type\": \"ARRAY\" }, \"template\": { \"properties\": { \"componentId\": { \"type\": \"STRING\" }, \"dataBinding\": { \"type\": \"STRING\" } }, \"required\": [ \"componentId\", \"dataBinding\" ], \"type\": \"OBJECT\" } }, \"type\": \"OBJECT\" }, \"distribution\": { \"description\": \"How children are aligned on the main axis. \", \"enum\": [ \"start\", \"center\", \"end\", \"spaceBetween\", \"spaceAround\", \"spaceEvenly\" ], \"type\": \"STRING\" } }, \"type\": \"OBJECT\" }, \"Text\": { \"properties\": { \"text\": { \"description\": \"While simple Markdown is supported (without HTML or image references), utilizing dedicated UI components is generally preferred for a richer and more structured presentation.\", \"properties\": { \"literalString\": { \"type\": \"STRING\" }, \"path\": { \"description\": \"A relative or absolute path in the data model.\", \"type\": \"STRING\" } }, \"type\": \"OBJECT\" }, \"usageHint\": { \"description\": \"A usage hint for the base text style.\", \"enum\": [ \"h1\", \"h2\", \"h3\", \"h4\", \"h5\", \"caption\", \"body\" ], \"type\": \"STRING\" } }, \"required\": [ \"text\" ], \"type\": \"OBJECT\" } }, \"type\": \"OBJECT\" }, \"id\": { \"type\": \"STRING\" }, \"weight\": { \"description\": \"Optional layout weight for use in Row/Column children.\", \"type\": \"INTEGER\" } }, \"required\": [ \"id\", \"component\" ], \"type\": \"OBJECT\" }, \"type\": \"ARRAY\" }, \"surfaceId\": { \"description\": \"The unique identifier for the UI surface to create or update. If you are adding a new surface this *must* be a new, unique identified that has never been used for any existing surfaces shown.\", \"type\": \"STRING\" } }, \"required\": [ \"surfaceId\", \"components\" ], \"type\": \"OBJECT\" } }, { \"description\": \"Signals the client to begin rendering a surface with a root component.\", \"name\": \"beginRendering\", \"parameters\": { \"properties\": { \"root\": { \"description\": \"The ID of the root widget. This ID must correspond to the ID of one of the widgets in the `components` list.\", \"type\": \"STRING\" }, \"surfaceId\": { \"description\": \"The unique identifier for the UI surface to render.\", \"type\": \"STRING\" } }, \"required\": [ \"surfaceId\", \"root\" ], \"type\": \"OBJECT\" } }, { \"description\": \"Returns the final output. Call this function when you are done with the current turn of the conversation. Do not call this if you need to use other tools first. You MUST call this tool when you are done.\", \"name\": \"provideFinalOutput\", \"parameters\": { \"properties\": { \"output\": { \"properties\": { \"response\": { \"type\": \"STRING\" } }, \"type\": \"OBJECT\" } }, \"type\": \"OBJECT\" } } ] } ] } LLM 响应最终结果，包含我们自定义提供的Code组件：\n{ \"candidates\": [ { \"content\": { \"parts\": [ { \"functionCall\": { \"args\": { \"components\": [ { \"component\": { \"Text\": { \"text\": { \"literalString\": \"Based on the information you provided, here is the CycBox configuration (config.yaml) and the Lua script (pms9103m_parser.lua) to parse the PMS9103M sensor data:\" }, \"usageHint\": \"h3\" } }, \"id\": \"config_intro\" }, { \"component\": { \"Code\": { \"code\": \"version: \\\"1.0\\\"\\ngroups:\\n app:\\n app_transport: \\\"serial\\\"\\n app_codec: \\\"frame_codec\\\"\\n app_transformer: \\\"disable\\\"\\n app_lua_script_enabled: true\\n app_encoding: \\\"UTF-8\\\"\\n serial:\\n serial_requires_codec: true\\n serial_port: \\\"/dev/ttyS0\\\" # Update if your serial port is different\\n serial_baud_rate: 9600\\n serial_data_bits: 8\\n serial_parity: \\\"none\\\"\\n serial_stop_bits: \\\"1\\\"\\n serial_flow_control: \\\"none\\\"\\n frame_codec:\\n frame_codec_prefix: \\\"42 4d\\\"\\n frame_codec_header_size: 0\\n frame_codec_length_mode: \\\"u16_be\\\"\\n frame_codec_length_meaning: \\\"payload_checksum\\\" # Length value 0x1C (28) covers 26 bytes payload + 2 bytes checksum\\n frame_codec_checksum_algo: \\\"sum16_be\\\" # Assuming 16-bit big-endian sum, adjust if your datasheet specifies a different algorithm\\n frame_codec_checksum_scope: \\\"prefix_header_length_payload\\\"\\n frame_codec_tailer_length: 0\\n frame_codec_suffix: \\\"\\\"\", \"filename\": \"config.yaml\", \"language\": \"yaml\" } }, \"id\": \"config_yaml_code\" }, { \"component\": { \"Code\": { \"code\": \"-- PMS9103M Air Quality Sensor Protocol Parser\\n-- Protocol: 32-byte binary frame with 0x42 0x4D prefix, 2-byte length (0x001C), 26-byte payload, and 2-byte checksum.\\n-- Data format: Big-Endian.\\n\\nfunction on_receive()\\n local payload = message:get_payload()\\n\\n -- Validate payload length. The frame codec strips prefix, length field, and checksum,\\n -- so the Lua payload should be 26 bytes (bytes 4-29 from the raw frame).\\n if #payload ~= 26 then\\n log(\\\"warn\\\", string.format(\\\"PMS9103M: Expected 26 bytes payload, got %d\\\", #payload))\\n return false\\n end\\n\\n -- Parse Atmospheric PM values (1-indexed offsets relative to the Lua payload)\\n -- Raw frame bytes 10-11 -\u003e Lua payload bytes 7-8\\n local pm1_0_atmospheric = read_u16_be(payload, 7)\\n -- Raw frame bytes 12-13 -\u003e Lua payload bytes 9-10\\n local pm2_5_atmospheric = read_u16_be(payload, 9)\\n -- Raw frame bytes 14-15 -\u003e Lua payload bytes 11-12\\n local pm10_atmospheric = read_u16_be(payload, 11)\\n\\n -- Add values for charting in the UI\\n message:add_int_value(\\\"PM1.0 Atmospheric (μg/m³)\\\", pm1_0_atmospheric)\\n message:add_int_value(\\\"PM2.5 Atmospheric (μg/m³)\\\", pm2_5_atmospheric)\\n message:add_int_value(\\\"PM10 Atmospheric (μg/m³)\\\", pm10_atmospheric)\\n\\n -- Log the parsed values\\n log(\\\"info\\\", string.format(\\\"PMS9103M: PM1.0 Atmos: %d μg/m³, PM2.5 Atmos: %d μg/m³, PM10 Atmos: %d μg/m³\\\", \\n pm1_0_atmospheric, pm2_5_atmospheric, pm10_atmospheric))\\n\\n return true\\nend\", \"filename\": \"pms9103m_parser.lua\", \"language\": \"lua\" } }, \"id\": \"lua_script_code\" }, { \"component\": { \"Column\": { \"children\": { \"explicitList\": [ \"config_intro\", \"config_yaml_code\", \"lua_script_code\" ] } } }, \"id\": \"main_column\" } ], \"surfaceId\": \"pms9103m_debug_config_script\" }, \"name\": \"surfaceUpdate\" }, \"thoughtSignature\": \"removed\" }, { \"functionCall\": { \"args\": { \"root\": \"main_column\", \"surfaceId\": \"pms9103m_debug_config_script\" }, \"name\": \"beginRendering\" } } ], \"role\": \"model\" }, \"finishMessage\": \"Model generated function call(s).\", \"finishReason\": \"STOP\", \"index\": 0 } ], \"modelVersion\": \"gemini-2.5-flash\", \"responseId\": \"removed\", \"usageMetadata\": { \"candidatesTokenCount\": 1143, \"promptTokenCount\": 6339, \"promptTokensDetails\": [ { \"modality\": \"TEXT\", \"tokenCount\": 6339 } ], \"thoughtsTokenCount\": 2541, \"totalTokenCount\": 10023 } } ",
  "wordCount" : "3688",
  "inLanguage": "zh-cn",
  "datePublished": "2025-12-03T00:00:00Z",
  "dateModified": "2025-12-03T00:00:00Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://yplam.com/posts/machinelearning/flutter-genui/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "YPLAM",
    "logo": {
      "@type": "ImageObject",
      "url": "https://yplam.com/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <div class="logo-switches">
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://yplam.com/" title="YPLAM">
                    <span>HOME</span>

                </a>
            </li>
            <li>
                <a href="https://yplam.com/about/" title="关于YPLam">
                    <span>ABOUT</span>

                </a>
            </li>
            <li>
                <a href="https://github.com/yplam" title="GITHUB">
                    <span>GITHUB</span>

                </a>
            </li>
            <li>
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Flutter GenUI 初探
    </h1>
    <div class="post-meta"><span title='2025-12-03 00:00:00 +0000 UTC'>2025-12-03</span>

</div>
  </header> 
  <div class="post-content"><p>Flutter 官方最近发布了 <a href="https://docs.flutter.dev/ai/genui">GenUI SDK for Flutter</a> , 其理念就是通过 GenUI SDK 作为编排层，将用户与 AI Agent 间的交互从文本转变为丰富的交互式UI。</p>
<h2 id="genui-如何工作">GenUI 如何工作？<a hidden class="anchor" aria-hidden="true" href="#genui-如何工作">#</a></h2>
<p>GenUI 由多个组件组成：</p>
<ul>
<li>GenUiConversation： GenUI 的主要交互入口。它包含 GenUiManager 和 ContentGenerator 类，管理对话历史记录，并协调整个生成式 UI 流程。</li>
<li>Catalog： CatalogItem 对象集合，定义了 AI 可以使用的组件集。每个 CatalogItem 都指定一个组件的名称（供 AI 引用）、其属性的数据模式以及用于渲染 Flutter 组件的构建器函数。</li>
<li>DataModel： 一个集中式的、可观察的动态 UI 状态存储。组件绑定到此模型中的数据。当数据更改时，仅重建依赖于该特定数据的组件。</li>
<li>ContentGenerator： 用于与生成式 AI 模型通信的接口。此接口使用流将 A2uiMessage 命令、文本响应和错误发送回 GenUiConversation。</li>
<li>A2uiMessage： AI（通过内容生成器）向 UI 发送的消息，指示 UI 执行诸如 beginRendering、surfaceUpdate、dataModelUpdate 或 deleteSurface 之类的操作。</li>
</ul>
<p>其基础流程就是，开发者通过 CatalogItem 定义一些 UI 组件，每一个 UI 组件 包含以下主要元素：</p>
<ol>
<li>name: CatalogItem 名称，在 json 返回时会用出字段作为 key</li>
<li>dataSchema： 通过 json schema 描述的组件状态数据结构</li>
<li>widgetBuilder： 如何基于模型根据 dataSchema 格式返回的数据来渲染组件</li>
<li>可选的 example</li>
</ol>
<p>ContentGenerator 在发送请求到后端 LLM API 时，会将开发者定义的 CatalogItem 列表作为 surfaceUpdate function call 的参数定义，同时发送到后端。LLM 通过 functionCall 的方式调用 surfaceUpdate 来更新、定义 UI 组件以及状态，然后通过 beginRendering 的 functionCall 来触发 GenUiManager 渲染界面。而其中用到的数据结构就是 A2uiMessage。而用户在 UI 界面上的交互也会用 UserMessage 的方式将组件状态数据上报。</p>
<p>其中的关键是，<strong>GenUI SDK 并不仅仅是预定义若干固定的 UI 组件，而是尝试让 LLM 通过组合 UI 组件的方式去生成复杂的用户交互 UI</strong>。而其中的挑战是如何通过有限的 System Prompt 来让 LLM 根据需要组合出稳定可用的交互 UI，根据用户的交互确定用户目标。</p>
<h2 id="genui-基础功能测试">GenUI 基础功能测试<a hidden class="anchor" aria-hidden="true" href="#genui-基础功能测试">#</a></h2>
<p>GenUI SDK 提供 18 个预定义的 CoreCatalogItems：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dart" data-lang="dart"><span class="line"><span class="cl"><span class="kd">static</span> <span class="n">Catalog</span> <span class="n">asCatalog</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">Catalog</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">      <span class="n">audioPlayer</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">button</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">card</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">checkBox</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">column</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">dateTimeInput</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">divider</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">icon</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">image</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">list</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">modal</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">multipleChoice</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">row</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">slider</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">tabs</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">text</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">textField</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">video</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">]);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></div><p>然而初步测试下来，虽然已经在 System Prompt 上做了不少控制，也难以使用 gemini-2.5-flash 模型生成稳定可用的 UI，特别是 button、textField 等用户交互类组件。因此只使用几个简单的展示类组件，以及自己编写一个代码高亮组件供 GenUI 使用：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dart" data-lang="dart"><span class="line"><span class="cl"><span class="kd">final</span> <span class="n">appCatalog</span> <span class="o">=</span> <span class="n">Catalog</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">    <span class="n">CoreCatalogItems</span><span class="p">.</span><span class="n">column</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">CoreCatalogItems</span><span class="p">.</span><span class="n">text</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">codeCatalogItem</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">]);</span>
</span></span></code></pre></div><p>参考官方教程 <a href="https://docs.flutter.dev/ai/genui/get-started">Get started with the GenUI SDK for Flutter</a> , 对于国内用户需要实现自己的 GoogleGenerativeServiceInterface 来解决网络问题。目标是在 <a href="https://github.com/cycbox/cycbox">CycBox</a> 中集成 AI 根据用户需求生成配置文件与 Lua 脚本功能。</p>
<p>CycBox Chatbot 效果截图：</p>
<p><img alt="CycBox Chatbot" loading="lazy" src="/assets/2025/2025-12-03-flutter-genui.png"></p>
<p>总体而言， LLM 基本能理解用户意图生成可交互的组件组合，而由于 GenUiManager 帮忙接管了 UI 渲染，的确使得 AI Agent 的交互编程变得非常简单。</p>
<h2 id="genui-sdk-后端-api-请求与响应">GenUI SDK 后端 API 请求与响应<a hidden class="anchor" aria-hidden="true" href="#genui-sdk-后端-api-请求与响应">#</a></h2>
<p>最后，通过对 GenUI SDK 接口请求与响应数据的抓包，可以更直观地看到以上交互是如何实现的：</p>
<p>发送请求，带上组件定义：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;contents&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;parts&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;text&#34;</span><span class="p">:</span> <span class="s2">&#34;You are a CycBox IoT debugging assistant specializing in Lua script generation. SystemPromptRemoved&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;parts&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;text&#34;</span><span class="p">:</span> <span class="s2">&#34;Could you help me debug PMS9103M Air Quality Sensor?&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;role&#34;</span><span class="p">:</span> <span class="s2">&#34;user&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;model&#34;</span><span class="p">:</span> <span class="s2">&#34;models/gemini-2.5-flash&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;toolConfig&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;functionCallingConfig&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;allowedFunctionNames&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;surfaceUpdate&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;beginRendering&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;provideFinalOutput&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;mode&#34;</span><span class="p">:</span> <span class="s2">&#34;ANY&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;tools&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;functionDeclarations&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Updates a surface with a new set of components.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;surfaceUpdate&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;parameters&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;components&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;A list of component definitions.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;items&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Represents a *single* component in a UI widget tree. This component could be one of many supported types.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;component&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;A wrapper object that MUST contain exactly one key, which is the name of the component type (e.g., &#39;Heading&#39;). The value is an object containing the properties for that specific component.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;Code&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                          <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;code&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;The source code to display&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">                            <span class="p">},</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;filename&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Optional filename or description to display as header&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">                            <span class="p">},</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;language&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Programming language for syntax highlighting&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;enum&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;dart&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;lua&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;yaml&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;javascript&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;python&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;json&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;bash&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;c&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;cpp&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;java&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;rust&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;go&#34;</span>
</span></span><span class="line"><span class="cl">                              <span class="p">],</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">                            <span class="p">}</span>
</span></span><span class="line"><span class="cl">                          <span class="p">},</span>
</span></span><span class="line"><span class="cl">                          <span class="nt">&#34;required&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;code&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;language&#34;</span>
</span></span><span class="line"><span class="cl">                          <span class="p">],</span>
</span></span><span class="line"><span class="cl">                          <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;OBJECT&#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="p">},</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;Column&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                          <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;alignment&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;How children are aligned on the cross axis. &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;enum&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;start&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;center&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;end&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;stretch&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;baseline&#34;</span>
</span></span><span class="line"><span class="cl">                              <span class="p">],</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">                            <span class="p">},</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;children&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Either an explicit list of widget IDs for the children, or a template with a data binding to the list of children.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;explicitList&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                  <span class="nt">&#34;items&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                    <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">                                  <span class="p">},</span>
</span></span><span class="line"><span class="cl">                                  <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;ARRAY&#34;</span>
</span></span><span class="line"><span class="cl">                                <span class="p">},</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;template&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                  <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                    <span class="nt">&#34;componentId&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                      <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">                                    <span class="p">},</span>
</span></span><span class="line"><span class="cl">                                    <span class="nt">&#34;dataBinding&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                      <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">                                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                                  <span class="p">},</span>
</span></span><span class="line"><span class="cl">                                  <span class="nt">&#34;required&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                                    <span class="s2">&#34;componentId&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                    <span class="s2">&#34;dataBinding&#34;</span>
</span></span><span class="line"><span class="cl">                                  <span class="p">],</span>
</span></span><span class="line"><span class="cl">                                  <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;OBJECT&#34;</span>
</span></span><span class="line"><span class="cl">                                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                              <span class="p">},</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;OBJECT&#34;</span>
</span></span><span class="line"><span class="cl">                            <span class="p">},</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;distribution&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;How children are aligned on the main axis. &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;enum&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;start&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;center&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;end&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;spaceBetween&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;spaceAround&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;spaceEvenly&#34;</span>
</span></span><span class="line"><span class="cl">                              <span class="p">],</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">                            <span class="p">}</span>
</span></span><span class="line"><span class="cl">                          <span class="p">},</span>
</span></span><span class="line"><span class="cl">                          <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;OBJECT&#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="p">},</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;Text&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                          <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;text&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;While simple Markdown is supported (without HTML or image references), utilizing dedicated UI components is generally preferred for a richer and more structured presentation.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;literalString&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                  <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">                                <span class="p">},</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;path&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                  <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;A relative or absolute path in the data model.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                  <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">                                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                              <span class="p">},</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;OBJECT&#34;</span>
</span></span><span class="line"><span class="cl">                            <span class="p">},</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;usageHint&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;A usage hint for the base text style.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;enum&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;h1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;h2&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;h3&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;h4&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;h5&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;caption&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;body&#34;</span>
</span></span><span class="line"><span class="cl">                              <span class="p">],</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">                            <span class="p">}</span>
</span></span><span class="line"><span class="cl">                          <span class="p">},</span>
</span></span><span class="line"><span class="cl">                          <span class="nt">&#34;required&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;text&#34;</span>
</span></span><span class="line"><span class="cl">                          <span class="p">],</span>
</span></span><span class="line"><span class="cl">                          <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;OBJECT&#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="p">}</span>
</span></span><span class="line"><span class="cl">                      <span class="p">},</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;OBJECT&#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="p">},</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="p">},</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;weight&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Optional layout weight for use in Row/Column children.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;INTEGER&#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                  <span class="p">},</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;required&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;id&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;component&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">],</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;OBJECT&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="p">},</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;ARRAY&#34;</span>
</span></span><span class="line"><span class="cl">              <span class="p">},</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;surfaceId&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;The unique identifier for the UI surface to create or update. If you are adding a new surface this *must* be a new, unique identified that has never been used for any existing surfaces shown.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">              <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;required&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">              <span class="s2">&#34;surfaceId&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="s2">&#34;components&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;OBJECT&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Signals the client to begin rendering a surface with a root component.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;beginRendering&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;parameters&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;root&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;The ID of the root widget. This ID must correspond to the ID of one of the widgets in the `components` list.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">              <span class="p">},</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;surfaceId&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;The unique identifier for the UI surface to render.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">              <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;required&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">              <span class="s2">&#34;surfaceId&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="s2">&#34;root&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;OBJECT&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Returns the final output. Call this function when you are done with the current turn of the conversation. Do not call this if you need to use other tools first. You MUST call this tool when you are done.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;provideFinalOutput&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;parameters&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;output&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;response&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="p">},</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;OBJECT&#34;</span>
</span></span><span class="line"><span class="cl">              <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;OBJECT&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>LLM 返回响应，返回交互信息，实际上就是两个 functionCall， 包括 surfaceUpdate 与 beginRendering ，这个需要在 System Prompt 中详细说明，不然 LLM 可能无法生成正确的 UI 组件结构：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;candidates&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;content&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;parts&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">          <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;functionCall&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;args&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;components&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;component&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;Text&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;text&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                          <span class="nt">&#34;literalString&#34;</span><span class="p">:</span> <span class="s2">&#34;I can help you debug your PMS9103M Air Quality Sensor. To get started, please provide the following information:&#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="p">},</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;usageHint&#34;</span><span class="p">:</span> <span class="s2">&#34;h3&#34;</span>
</span></span><span class="line"><span class="cl">                      <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="p">},</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;intro_text&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">},</span>
</span></span><span class="line"><span class="cl">                  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;component&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;Text&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;text&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                          <span class="nt">&#34;literalString&#34;</span><span class="p">:</span> <span class="s2">&#34;1. Do you have the sensor&#39;s datasheet or protocol documentation available? This will help me understand the message structure.&#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="p">},</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;usageHint&#34;</span><span class="p">:</span> <span class="s2">&#34;body&#34;</span>
</span></span><span class="line"><span class="cl">                      <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="p">},</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;question_1&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">},</span>
</span></span><span class="line"><span class="cl">                  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;component&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;Text&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;text&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                          <span class="nt">&#34;literalString&#34;</span><span class="p">:</span> <span class="s2">&#34;2. How is the sensor connected to your system (e.g., Serial, USB-to-Serial, etc.)? What are the serial port parameters (baud rate, data bits, parity, stop bits, flow control)?&#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="p">},</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;usageHint&#34;</span><span class="p">:</span> <span class="s2">&#34;body&#34;</span>
</span></span><span class="line"><span class="cl">                      <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="p">},</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;question_2&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">},</span>
</span></span><span class="line"><span class="cl">                  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;component&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;Text&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;text&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                          <span class="nt">&#34;literalString&#34;</span><span class="p">:</span> <span class="s2">&#34;3. Can you provide any sample raw data (in hexadecimal format, if possible) that the sensor is sending?&#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="p">},</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;usageHint&#34;</span><span class="p">:</span> <span class="s2">&#34;body&#34;</span>
</span></span><span class="line"><span class="cl">                      <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="p">},</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;question_3&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">},</span>
</span></span><span class="line"><span class="cl">                  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;component&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;Text&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;text&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                          <span class="nt">&#34;literalString&#34;</span><span class="p">:</span> <span class="s2">&#34;4. What specific values or measurements do you want to extract from the sensor&#39;s data (e.g., PM1.0, PM2.5, PM10 concentrations)?&#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="p">},</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;usageHint&#34;</span><span class="p">:</span> <span class="s2">&#34;body&#34;</span>
</span></span><span class="line"><span class="cl">                      <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="p">},</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;question_4&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">},</span>
</span></span><span class="line"><span class="cl">                  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;component&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;Column&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;children&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                          <span class="nt">&#34;explicitList&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;intro_text&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;question_1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;question_2&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;question_3&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;question_4&#34;</span>
</span></span><span class="line"><span class="cl">                          <span class="p">]</span>
</span></span><span class="line"><span class="cl">                        <span class="p">}</span>
</span></span><span class="line"><span class="cl">                      <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="p">},</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;main_column&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="p">],</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;surfaceId&#34;</span><span class="p">:</span> <span class="s2">&#34;pms9103m_debug&#34;</span>
</span></span><span class="line"><span class="cl">              <span class="p">},</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;surfaceUpdate&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;thoughtSignature&#34;</span><span class="p">:</span> <span class="s2">&#34;removed&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="p">},</span>
</span></span><span class="line"><span class="cl">          <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;functionCall&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;args&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;root&#34;</span><span class="p">:</span> <span class="s2">&#34;main_column&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;surfaceId&#34;</span><span class="p">:</span> <span class="s2">&#34;pms9103m_debug&#34;</span>
</span></span><span class="line"><span class="cl">              <span class="p">},</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;beginRendering&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;role&#34;</span><span class="p">:</span> <span class="s2">&#34;model&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;finishMessage&#34;</span><span class="p">:</span> <span class="s2">&#34;Model generated function call(s).&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;finishReason&#34;</span><span class="p">:</span> <span class="s2">&#34;STOP&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;index&#34;</span><span class="p">:</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;modelVersion&#34;</span><span class="p">:</span> <span class="s2">&#34;gemini-2.5-flash&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;responseId&#34;</span><span class="p">:</span> <span class="s2">&#34;B-removed&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;usageMetadata&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;candidatesTokenCount&#34;</span><span class="p">:</span> <span class="mi">418</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;promptTokenCount&#34;</span><span class="p">:</span> <span class="mi">5379</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;promptTokensDetails&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;modality&#34;</span><span class="p">:</span> <span class="s2">&#34;TEXT&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;tokenCount&#34;</span><span class="p">:</span> <span class="mi">5379</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;thoughtsTokenCount&#34;</span><span class="p">:</span> <span class="mi">184</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;totalTokenCount&#34;</span><span class="p">:</span> <span class="mi">5981</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Flutter 更新 UI，然后响应 functionResponse：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;contents&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;parts&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;text&#34;</span><span class="p">:</span> <span class="s2">&#34;You are a CycBox IoT debugging assistant specializing in Lua script generation. SystemPromptRemoved&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;parts&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;text&#34;</span><span class="p">:</span> <span class="s2">&#34;Could you help me debug PMS9103M Air Quality Sensor?&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;role&#34;</span><span class="p">:</span> <span class="s2">&#34;user&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;parts&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;functionCall&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;args&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;components&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;component&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;Text&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;text&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;literalString&#34;</span><span class="p">:</span> <span class="s2">&#34;I can help you debug your PMS9103M Air Quality Sensor. To get started, please provide the following information:&#34;</span>
</span></span><span class="line"><span class="cl">                      <span class="p">},</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;usageHint&#34;</span><span class="p">:</span> <span class="s2">&#34;h3&#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                  <span class="p">},</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;intro_text&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="p">},</span>
</span></span><span class="line"><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;component&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;Text&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;text&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;literalString&#34;</span><span class="p">:</span> <span class="s2">&#34;1. Do you have the sensor&#39;s datasheet or protocol documentation available? This will help me understand the message structure.&#34;</span>
</span></span><span class="line"><span class="cl">                      <span class="p">},</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;usageHint&#34;</span><span class="p">:</span> <span class="s2">&#34;body&#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                  <span class="p">},</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;question_1&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="p">},</span>
</span></span><span class="line"><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;component&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;Text&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;text&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;literalString&#34;</span><span class="p">:</span> <span class="s2">&#34;2. How is the sensor connected to your system (e.g., Serial, USB-to-Serial, etc.)? What are the serial port parameters (baud rate, data bits, parity, stop bits, flow control)?&#34;</span>
</span></span><span class="line"><span class="cl">                      <span class="p">},</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;usageHint&#34;</span><span class="p">:</span> <span class="s2">&#34;body&#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                  <span class="p">},</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;question_2&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="p">},</span>
</span></span><span class="line"><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;component&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;Text&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;text&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;literalString&#34;</span><span class="p">:</span> <span class="s2">&#34;3. Can you provide any sample raw data (in hexadecimal format, if possible) that the sensor is sending?&#34;</span>
</span></span><span class="line"><span class="cl">                      <span class="p">},</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;usageHint&#34;</span><span class="p">:</span> <span class="s2">&#34;body&#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                  <span class="p">},</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;question_3&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="p">},</span>
</span></span><span class="line"><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;component&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;Text&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;text&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;literalString&#34;</span><span class="p">:</span> <span class="s2">&#34;4. What specific values or measurements do you want to extract from the sensor&#39;s data (e.g., PM1.0, PM2.5, PM10 concentrations)?&#34;</span>
</span></span><span class="line"><span class="cl">                      <span class="p">},</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;usageHint&#34;</span><span class="p">:</span> <span class="s2">&#34;body&#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                  <span class="p">},</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;question_4&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="p">},</span>
</span></span><span class="line"><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;component&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;Column&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;children&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;explicitList&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                          <span class="s2">&#34;intro_text&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                          <span class="s2">&#34;question_1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                          <span class="s2">&#34;question_2&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                          <span class="s2">&#34;question_3&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                          <span class="s2">&#34;question_4&#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="p">]</span>
</span></span><span class="line"><span class="cl">                      <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                  <span class="p">},</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;main_column&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">              <span class="p">],</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;surfaceId&#34;</span><span class="p">:</span> <span class="s2">&#34;pms9103m_debug&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;surfaceUpdate&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="p">},</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;thoughtSignature&#34;</span><span class="p">:</span> <span class="s2">&#34;removed&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;functionCall&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;args&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;root&#34;</span><span class="p">:</span> <span class="s2">&#34;main_column&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;surfaceId&#34;</span><span class="p">:</span> <span class="s2">&#34;pms9103m_debug&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;beginRendering&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;role&#34;</span><span class="p">:</span> <span class="s2">&#34;model&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;parts&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;functionResponse&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;surfaceUpdate&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;response&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;status&#34;</span><span class="p">:</span> <span class="s2">&#34;UI Surface pms9103m_debug updated.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;surfaceId&#34;</span><span class="p">:</span> <span class="s2">&#34;pms9103m_debug&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;functionResponse&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;beginRendering&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;response&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;status&#34;</span><span class="p">:</span> <span class="s2">&#34;Surface pms9103m_debug rendered and waiting for user input.&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;role&#34;</span><span class="p">:</span> <span class="s2">&#34;user&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;model&#34;</span><span class="p">:</span> <span class="s2">&#34;models/gemini-2.5-flash&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;toolConfig&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;functionCallingConfig&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;allowedFunctionNames&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;surfaceUpdate&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;beginRendering&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;provideFinalOutput&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;mode&#34;</span><span class="p">:</span> <span class="s2">&#34;ANY&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;tools&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;functionDeclarations&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Updates a surface with a new set of components.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;surfaceUpdate&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;parameters&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;components&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;A list of component definitions.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;items&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Represents a *single* component in a UI widget tree. This component could be one of many supported types.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;component&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;A wrapper object that MUST contain exactly one key, which is the name of the component type (e.g., &#39;Heading&#39;). The value is an object containing the properties for that specific component.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;Code&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                          <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;code&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;The source code to display&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">                            <span class="p">},</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;filename&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Optional filename or description to display as header&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">                            <span class="p">},</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;language&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Programming language for syntax highlighting&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;enum&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;dart&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;lua&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;yaml&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;javascript&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;python&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;json&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;bash&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;c&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;cpp&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;java&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;rust&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;go&#34;</span>
</span></span><span class="line"><span class="cl">                              <span class="p">],</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">                            <span class="p">}</span>
</span></span><span class="line"><span class="cl">                          <span class="p">},</span>
</span></span><span class="line"><span class="cl">                          <span class="nt">&#34;required&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;code&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;language&#34;</span>
</span></span><span class="line"><span class="cl">                          <span class="p">],</span>
</span></span><span class="line"><span class="cl">                          <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;OBJECT&#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="p">},</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;Column&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                          <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;alignment&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;How children are aligned on the cross axis. &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;enum&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;start&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;center&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;end&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;stretch&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;baseline&#34;</span>
</span></span><span class="line"><span class="cl">                              <span class="p">],</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">                            <span class="p">},</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;children&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Either an explicit list of widget IDs for the children, or a template with a data binding to the list of children.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;explicitList&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                  <span class="nt">&#34;items&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                    <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">                                  <span class="p">},</span>
</span></span><span class="line"><span class="cl">                                  <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;ARRAY&#34;</span>
</span></span><span class="line"><span class="cl">                                <span class="p">},</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;template&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                  <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                    <span class="nt">&#34;componentId&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                      <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">                                    <span class="p">},</span>
</span></span><span class="line"><span class="cl">                                    <span class="nt">&#34;dataBinding&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                      <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">                                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                                  <span class="p">},</span>
</span></span><span class="line"><span class="cl">                                  <span class="nt">&#34;required&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                                    <span class="s2">&#34;componentId&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                    <span class="s2">&#34;dataBinding&#34;</span>
</span></span><span class="line"><span class="cl">                                  <span class="p">],</span>
</span></span><span class="line"><span class="cl">                                  <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;OBJECT&#34;</span>
</span></span><span class="line"><span class="cl">                                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                              <span class="p">},</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;OBJECT&#34;</span>
</span></span><span class="line"><span class="cl">                            <span class="p">},</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;distribution&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;How children are aligned on the main axis. &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;enum&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;start&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;center&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;end&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;spaceBetween&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;spaceAround&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;spaceEvenly&#34;</span>
</span></span><span class="line"><span class="cl">                              <span class="p">],</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">                            <span class="p">}</span>
</span></span><span class="line"><span class="cl">                          <span class="p">},</span>
</span></span><span class="line"><span class="cl">                          <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;OBJECT&#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="p">},</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;Text&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                          <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;text&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;While simple Markdown is supported (without HTML or image references), utilizing dedicated UI components is generally preferred for a richer and more structured presentation.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;literalString&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                  <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">                                <span class="p">},</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;path&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                  <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;A relative or absolute path in the data model.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                  <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">                                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                              <span class="p">},</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;OBJECT&#34;</span>
</span></span><span class="line"><span class="cl">                            <span class="p">},</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;usageHint&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;A usage hint for the base text style.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;enum&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;h1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;h2&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;h3&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;h4&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;h5&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;caption&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;body&#34;</span>
</span></span><span class="line"><span class="cl">                              <span class="p">],</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">                            <span class="p">}</span>
</span></span><span class="line"><span class="cl">                          <span class="p">},</span>
</span></span><span class="line"><span class="cl">                          <span class="nt">&#34;required&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;text&#34;</span>
</span></span><span class="line"><span class="cl">                          <span class="p">],</span>
</span></span><span class="line"><span class="cl">                          <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;OBJECT&#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="p">}</span>
</span></span><span class="line"><span class="cl">                      <span class="p">},</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;OBJECT&#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="p">},</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="p">},</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;weight&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Optional layout weight for use in Row/Column children.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;INTEGER&#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                  <span class="p">},</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;required&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;id&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;component&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">],</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;OBJECT&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="p">},</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;ARRAY&#34;</span>
</span></span><span class="line"><span class="cl">              <span class="p">},</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;surfaceId&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;The unique identifier for the UI surface to create or update. If you are adding a new surface this *must* be a new, unique identified that has never been used for any existing surfaces shown.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">              <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;required&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">              <span class="s2">&#34;surfaceId&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="s2">&#34;components&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;OBJECT&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Signals the client to begin rendering a surface with a root component.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;beginRendering&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;parameters&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;root&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;The ID of the root widget. This ID must correspond to the ID of one of the widgets in the `components` list.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">              <span class="p">},</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;surfaceId&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;The unique identifier for the UI surface to render.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">              <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;required&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">              <span class="s2">&#34;surfaceId&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="s2">&#34;root&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;OBJECT&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Returns the final output. Call this function when you are done with the current turn of the conversation. Do not call this if you need to use other tools first. You MUST call this tool when you are done.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;provideFinalOutput&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;parameters&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;output&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;response&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="p">},</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;OBJECT&#34;</span>
</span></span><span class="line"><span class="cl">              <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;OBJECT&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>LLM 在接收到响应后会输出 provideFinalOutput，单个交互过程结束：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;candidates&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;content&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;parts&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">          <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;functionCall&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;args&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;output&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;response&#34;</span><span class="p">:</span> <span class="s2">&#34;I&#39;ve displayed some questions to help me understand your setup. Please provide the requested information so I can generate the appropriate CycBox configuration and Lua script.&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">              <span class="p">},</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;provideFinalOutput&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;thoughtSignature&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;role&#34;</span><span class="p">:</span> <span class="s2">&#34;model&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;finishMessage&#34;</span><span class="p">:</span> <span class="s2">&#34;Model generated function call(s).&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;finishReason&#34;</span><span class="p">:</span> <span class="s2">&#34;STOP&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;index&#34;</span><span class="p">:</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;modelVersion&#34;</span><span class="p">:</span> <span class="s2">&#34;gemini-2.5-flash&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;responseId&#34;</span><span class="p">:</span> <span class="s2">&#34;removed&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;usageMetadata&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;candidatesTokenCount&#34;</span><span class="p">:</span> <span class="mi">49</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;promptTokenCount&#34;</span><span class="p">:</span> <span class="mi">5865</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;promptTokensDetails&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;modality&#34;</span><span class="p">:</span> <span class="s2">&#34;TEXT&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;tokenCount&#34;</span><span class="p">:</span> <span class="mi">5865</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;thoughtsTokenCount&#34;</span><span class="p">:</span> <span class="mi">82</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;totalTokenCount&#34;</span><span class="p">:</span> <span class="mi">5996</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>用户再次输入，请求：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;contents&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;parts&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;text&#34;</span><span class="p">:</span> <span class="s2">&#34;You are a CycBox IoT debugging assistant specializing in Lua script generation. SystemPromptRemoved&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;parts&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;text&#34;</span><span class="p">:</span> <span class="s2">&#34;Could you help me debug PMS9103M Air Quality Sensor?&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;role&#34;</span><span class="p">:</span> <span class="s2">&#34;user&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;parts&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;text&#34;</span><span class="p">:</span> <span class="s2">&#34;A user interface is shown with the following content:\n{\&#34;surfaceId\&#34;:\&#34;pms9103m_debug\&#34;,\&#34;rootComponentId\&#34;:\&#34;main_column\&#34;,\&#34;components\&#34;:{\&#34;intro_text\&#34;:{\&#34;id\&#34;:\&#34;intro_text\&#34;,\&#34;component\&#34;:{\&#34;Text\&#34;:{\&#34;text\&#34;:{\&#34;literalString\&#34;:\&#34;I can help you debug your PMS9103M Air Quality Sensor. To get started, please provide the following information:\&#34;},\&#34;usageHint\&#34;:\&#34;h3\&#34;}}},\&#34;question_1\&#34;:{\&#34;id\&#34;:\&#34;question_1\&#34;,\&#34;component\&#34;:{\&#34;Text\&#34;:{\&#34;text\&#34;:{\&#34;literalString\&#34;:\&#34;1. Do you have the sensor&#39;s datasheet or protocol documentation available? This will help me understand the message structure.\&#34;},\&#34;usageHint\&#34;:\&#34;body\&#34;}}},\&#34;question_2\&#34;:{\&#34;id\&#34;:\&#34;question_2\&#34;,\&#34;component\&#34;:{\&#34;Text\&#34;:{\&#34;usageHint\&#34;:\&#34;body\&#34;,\&#34;text\&#34;:{\&#34;literalString\&#34;:\&#34;2. How is the sensor connected to your system (e.g., Serial, USB-to-Serial, etc.)? What are the serial port parameters (baud rate, data bits, parity, stop bits, flow control)?\&#34;}}}},\&#34;question_3\&#34;:{\&#34;id\&#34;:\&#34;question_3\&#34;,\&#34;component\&#34;:{\&#34;Text\&#34;:{\&#34;text\&#34;:{\&#34;literalString\&#34;:\&#34;3. Can you provide any sample raw data (in hexadecimal format, if possible) that the sensor is sending?\&#34;},\&#34;usageHint\&#34;:\&#34;body\&#34;}}},\&#34;question_4\&#34;:{\&#34;id\&#34;:\&#34;question_4\&#34;,\&#34;component\&#34;:{\&#34;Text\&#34;:{\&#34;text\&#34;:{\&#34;literalString\&#34;:\&#34;4. What specific values or measurements do you want to extract from the sensor&#39;s data (e.g., PM1.0, PM2.5, PM10 concentrations)?\&#34;},\&#34;usageHint\&#34;:\&#34;body\&#34;}}},\&#34;main_column\&#34;:{\&#34;id\&#34;:\&#34;main_column\&#34;,\&#34;component\&#34;:{\&#34;Column\&#34;:{\&#34;children\&#34;:{\&#34;explicitList\&#34;:[\&#34;intro_text\&#34;,\&#34;question_1\&#34;,\&#34;question_2\&#34;,\&#34;question_3\&#34;,\&#34;question_4\&#34;]}}}}}}.&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;role&#34;</span><span class="p">:</span> <span class="s2">&#34;model&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;parts&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;text&#34;</span><span class="p">:</span> <span class="s2">&#34;I&#39;ve displayed some questions to help me understand your setup. Please provide the requested information so I can generate the appropriate CycBox configuration and Lua script.&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;role&#34;</span><span class="p">:</span> <span class="s2">&#34;model&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;parts&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;text&#34;</span><span class="p">:</span> <span class="s2">&#34;The sensor uses a standard UART (Serial) interface with  Baud Rate: 9600 bps, Data Bits: 8, Parity: None, Stop Bits: 1, Flow Control: None\n\nThe data packet is **32 Bytes** long. The format is Big-Endian (High Byte first).\n\n\n| Byte Index | Value/Description | Note |\n| :--- | :--- | :--- |\n| 0 | **0x42** | Start Character 1 (Fixed) |\n| 1 | **0x4D** | Start Character 2 (Fixed) |\n| 2 | Frame Length High | Fixed at 0x00 |\n| 3 | Frame Length Low | Fixed at 0x1C (28 decimal) |\n| 4 | **PM1.0 (Standard) High** | CF=1, Standard Particle |\n| 5 | **PM1.0 (Standard) Low** | Unit: μg/m³ |\n| 6 | **PM2.5 (Standard) High** | CF=1, Standard Particle |\n| 7 | **PM2.5 (Standard) Low** | Unit: μg/m³ |\n| 8 | **PM10 (Standard) High** | CF=1, Standard Particle |\n| 9 | **PM10 (Standard) Low** | Unit: μg/m³ |\n| 10 | **PM1.0 (Atmospheric) High** | **Use this for Air Quality** |\n| 11 | **PM1.0 (Atmospheric) Low** | Unit: μg/m³ |\n| 12 | **PM2.5 (Atmospheric) High** | **Use this for Air Quality** |\n| 13 | **PM2.5 (Atmospheric) Low** | Unit: μg/m³ |\n| 14 | **PM10 (Atmospheric) High** | **Use this for Air Quality** |\n| 15 | **PM10 (Atmospheric) Low** | Unit: μg/m³ |\n| 16-27 | Particle Counts | &gt;0.3um, &gt;0.5um, &gt;1.0um, &gt;2.5um, &gt;5.0um, &gt;10um |\n| 28 | Version No. | |\n| 29 | Error Code | |\n| 30 | **Checksum High** | |\n| 31 | **Checksum Low** | |&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;role&#34;</span><span class="p">:</span> <span class="s2">&#34;user&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;model&#34;</span><span class="p">:</span> <span class="s2">&#34;models/gemini-2.5-flash&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;toolConfig&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;functionCallingConfig&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;allowedFunctionNames&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;surfaceUpdate&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;beginRendering&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;provideFinalOutput&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;mode&#34;</span><span class="p">:</span> <span class="s2">&#34;ANY&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;tools&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;functionDeclarations&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Updates a surface with a new set of components.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;surfaceUpdate&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;parameters&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;components&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;A list of component definitions.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;items&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Represents a *single* component in a UI widget tree. This component could be one of many supported types.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;component&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;A wrapper object that MUST contain exactly one key, which is the name of the component type (e.g., &#39;Heading&#39;). The value is an object containing the properties for that specific component.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;Code&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                          <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;code&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;The source code to display&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">                            <span class="p">},</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;filename&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Optional filename or description to display as header&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">                            <span class="p">},</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;language&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Programming language for syntax highlighting&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;enum&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;dart&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;lua&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;yaml&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;javascript&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;python&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;json&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;bash&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;c&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;cpp&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;java&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;rust&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;go&#34;</span>
</span></span><span class="line"><span class="cl">                              <span class="p">],</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">                            <span class="p">}</span>
</span></span><span class="line"><span class="cl">                          <span class="p">},</span>
</span></span><span class="line"><span class="cl">                          <span class="nt">&#34;required&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;code&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;language&#34;</span>
</span></span><span class="line"><span class="cl">                          <span class="p">],</span>
</span></span><span class="line"><span class="cl">                          <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;OBJECT&#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="p">},</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;Column&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                          <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;alignment&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;How children are aligned on the cross axis. &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;enum&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;start&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;center&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;end&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;stretch&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;baseline&#34;</span>
</span></span><span class="line"><span class="cl">                              <span class="p">],</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">                            <span class="p">},</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;children&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Either an explicit list of widget IDs for the children, or a template with a data binding to the list of children.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;explicitList&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                  <span class="nt">&#34;items&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                    <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">                                  <span class="p">},</span>
</span></span><span class="line"><span class="cl">                                  <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;ARRAY&#34;</span>
</span></span><span class="line"><span class="cl">                                <span class="p">},</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;template&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                  <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                    <span class="nt">&#34;componentId&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                      <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">                                    <span class="p">},</span>
</span></span><span class="line"><span class="cl">                                    <span class="nt">&#34;dataBinding&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                      <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">                                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                                  <span class="p">},</span>
</span></span><span class="line"><span class="cl">                                  <span class="nt">&#34;required&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                                    <span class="s2">&#34;componentId&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                    <span class="s2">&#34;dataBinding&#34;</span>
</span></span><span class="line"><span class="cl">                                  <span class="p">],</span>
</span></span><span class="line"><span class="cl">                                  <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;OBJECT&#34;</span>
</span></span><span class="line"><span class="cl">                                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                              <span class="p">},</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;OBJECT&#34;</span>
</span></span><span class="line"><span class="cl">                            <span class="p">},</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;distribution&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;How children are aligned on the main axis. &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;enum&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;start&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;center&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;end&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;spaceBetween&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;spaceAround&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;spaceEvenly&#34;</span>
</span></span><span class="line"><span class="cl">                              <span class="p">],</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">                            <span class="p">}</span>
</span></span><span class="line"><span class="cl">                          <span class="p">},</span>
</span></span><span class="line"><span class="cl">                          <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;OBJECT&#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="p">},</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;Text&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                          <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;text&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;While simple Markdown is supported (without HTML or image references), utilizing dedicated UI components is generally preferred for a richer and more structured presentation.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;literalString&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                  <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">                                <span class="p">},</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;path&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                  <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;A relative or absolute path in the data model.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                  <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">                                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                              <span class="p">},</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;OBJECT&#34;</span>
</span></span><span class="line"><span class="cl">                            <span class="p">},</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;usageHint&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;A usage hint for the base text style.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;enum&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;h1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;h2&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;h3&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;h4&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;h5&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;caption&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s2">&#34;body&#34;</span>
</span></span><span class="line"><span class="cl">                              <span class="p">],</span>
</span></span><span class="line"><span class="cl">                              <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">                            <span class="p">}</span>
</span></span><span class="line"><span class="cl">                          <span class="p">},</span>
</span></span><span class="line"><span class="cl">                          <span class="nt">&#34;required&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;text&#34;</span>
</span></span><span class="line"><span class="cl">                          <span class="p">],</span>
</span></span><span class="line"><span class="cl">                          <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;OBJECT&#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="p">}</span>
</span></span><span class="line"><span class="cl">                      <span class="p">},</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;OBJECT&#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="p">},</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="p">},</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;weight&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Optional layout weight for use in Row/Column children.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;INTEGER&#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                  <span class="p">},</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;required&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;id&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;component&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">],</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;OBJECT&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="p">},</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;ARRAY&#34;</span>
</span></span><span class="line"><span class="cl">              <span class="p">},</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;surfaceId&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;The unique identifier for the UI surface to create or update. If you are adding a new surface this *must* be a new, unique identified that has never been used for any existing surfaces shown.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">              <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;required&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">              <span class="s2">&#34;surfaceId&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="s2">&#34;components&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;OBJECT&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Signals the client to begin rendering a surface with a root component.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;beginRendering&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;parameters&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;root&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;The ID of the root widget. This ID must correspond to the ID of one of the widgets in the `components` list.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">              <span class="p">},</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;surfaceId&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;The unique identifier for the UI surface to render.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">              <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;required&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">              <span class="s2">&#34;surfaceId&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="s2">&#34;root&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;OBJECT&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Returns the final output. Call this function when you are done with the current turn of the conversation. Do not call this if you need to use other tools first. You MUST call this tool when you are done.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;provideFinalOutput&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;parameters&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;output&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;response&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="p">},</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;OBJECT&#34;</span>
</span></span><span class="line"><span class="cl">              <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;OBJECT&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>LLM 响应最终结果，包含我们自定义提供的Code组件：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;candidates&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;content&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;parts&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">          <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;functionCall&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;args&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;components&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;component&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;Text&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;text&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                          <span class="nt">&#34;literalString&#34;</span><span class="p">:</span> <span class="s2">&#34;Based on the information you provided, here is the CycBox configuration (config.yaml) and the Lua script (pms9103m_parser.lua) to parse the PMS9103M sensor data:&#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="p">},</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;usageHint&#34;</span><span class="p">:</span> <span class="s2">&#34;h3&#34;</span>
</span></span><span class="line"><span class="cl">                      <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="p">},</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;config_intro&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">},</span>
</span></span><span class="line"><span class="cl">                  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;component&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;Code&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;code&#34;</span><span class="p">:</span> <span class="s2">&#34;version: \&#34;1.0\&#34;\ngroups:\n  app:\n    app_transport: \&#34;serial\&#34;\n    app_codec: \&#34;frame_codec\&#34;\n    app_transformer: \&#34;disable\&#34;\n    app_lua_script_enabled: true\n    app_encoding: \&#34;UTF-8\&#34;\n  serial:\n    serial_requires_codec: true\n    serial_port: \&#34;/dev/ttyS0\&#34; # Update if your serial port is different\n    serial_baud_rate: 9600\n    serial_data_bits: 8\n    serial_parity: \&#34;none\&#34;\n    serial_stop_bits: \&#34;1\&#34;\n    serial_flow_control: \&#34;none\&#34;\n  frame_codec:\n    frame_codec_prefix: \&#34;42 4d\&#34;\n    frame_codec_header_size: 0\n    frame_codec_length_mode: \&#34;u16_be\&#34;\n    frame_codec_length_meaning: \&#34;payload_checksum\&#34; # Length value 0x1C (28) covers 26 bytes payload + 2 bytes checksum\n    frame_codec_checksum_algo: \&#34;sum16_be\&#34; # Assuming 16-bit big-endian sum, adjust if your datasheet specifies a different algorithm\n    frame_codec_checksum_scope: \&#34;prefix_header_length_payload\&#34;\n    frame_codec_tailer_length: 0\n    frame_codec_suffix: \&#34;\&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;filename&#34;</span><span class="p">:</span> <span class="s2">&#34;config.yaml&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;language&#34;</span><span class="p">:</span> <span class="s2">&#34;yaml&#34;</span>
</span></span><span class="line"><span class="cl">                      <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="p">},</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;config_yaml_code&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">},</span>
</span></span><span class="line"><span class="cl">                  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;component&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;Code&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;code&#34;</span><span class="p">:</span> <span class="s2">&#34;-- PMS9103M Air Quality Sensor Protocol Parser\n-- Protocol: 32-byte binary frame with 0x42 0x4D prefix, 2-byte length (0x001C), 26-byte payload, and 2-byte checksum.\n-- Data format: Big-Endian.\n\nfunction on_receive()\n    local payload = message:get_payload()\n\n    -- Validate payload length. The frame codec strips prefix, length field, and checksum,\n    -- so the Lua payload should be 26 bytes (bytes 4-29 from the raw frame).\n    if #payload ~= 26 then\n        log(\&#34;warn\&#34;, string.format(\&#34;PMS9103M: Expected 26 bytes payload, got %d\&#34;, #payload))\n        return false\n    end\n\n    -- Parse Atmospheric PM values (1-indexed offsets relative to the Lua payload)\n    -- Raw frame bytes 10-11 -&gt; Lua payload bytes 7-8\n    local pm1_0_atmospheric = read_u16_be(payload, 7)\n    -- Raw frame bytes 12-13 -&gt; Lua payload bytes 9-10\n    local pm2_5_atmospheric = read_u16_be(payload, 9)\n    -- Raw frame bytes 14-15 -&gt; Lua payload bytes 11-12\n    local pm10_atmospheric = read_u16_be(payload, 11)\n\n    -- Add values for charting in the UI\n    message:add_int_value(\&#34;PM1.0 Atmospheric (μg/m³)\&#34;, pm1_0_atmospheric)\n    message:add_int_value(\&#34;PM2.5 Atmospheric (μg/m³)\&#34;, pm2_5_atmospheric)\n    message:add_int_value(\&#34;PM10 Atmospheric (μg/m³)\&#34;, pm10_atmospheric)\n\n    -- Log the parsed values\n    log(\&#34;info\&#34;, string.format(\&#34;PMS9103M: PM1.0 Atmos: %d μg/m³, PM2.5 Atmos: %d μg/m³, PM10 Atmos: %d μg/m³\&#34;, \n                            pm1_0_atmospheric, pm2_5_atmospheric, pm10_atmospheric))\n\n    return true\nend&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;filename&#34;</span><span class="p">:</span> <span class="s2">&#34;pms9103m_parser.lua&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;language&#34;</span><span class="p">:</span> <span class="s2">&#34;lua&#34;</span>
</span></span><span class="line"><span class="cl">                      <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="p">},</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;lua_script_code&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">},</span>
</span></span><span class="line"><span class="cl">                  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;component&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="nt">&#34;Column&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;children&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                          <span class="nt">&#34;explicitList&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;config_intro&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;config_yaml_code&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;lua_script_code&#34;</span>
</span></span><span class="line"><span class="cl">                          <span class="p">]</span>
</span></span><span class="line"><span class="cl">                        <span class="p">}</span>
</span></span><span class="line"><span class="cl">                      <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="p">},</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;main_column&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="p">],</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;surfaceId&#34;</span><span class="p">:</span> <span class="s2">&#34;pms9103m_debug_config_script&#34;</span>
</span></span><span class="line"><span class="cl">              <span class="p">},</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;surfaceUpdate&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;thoughtSignature&#34;</span><span class="p">:</span> <span class="s2">&#34;removed&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="p">},</span>
</span></span><span class="line"><span class="cl">          <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;functionCall&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;args&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;root&#34;</span><span class="p">:</span> <span class="s2">&#34;main_column&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;surfaceId&#34;</span><span class="p">:</span> <span class="s2">&#34;pms9103m_debug_config_script&#34;</span>
</span></span><span class="line"><span class="cl">              <span class="p">},</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;beginRendering&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;role&#34;</span><span class="p">:</span> <span class="s2">&#34;model&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;finishMessage&#34;</span><span class="p">:</span> <span class="s2">&#34;Model generated function call(s).&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;finishReason&#34;</span><span class="p">:</span> <span class="s2">&#34;STOP&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;index&#34;</span><span class="p">:</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;modelVersion&#34;</span><span class="p">:</span> <span class="s2">&#34;gemini-2.5-flash&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;responseId&#34;</span><span class="p">:</span> <span class="s2">&#34;removed&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;usageMetadata&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;candidatesTokenCount&#34;</span><span class="p">:</span> <span class="mi">1143</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;promptTokenCount&#34;</span><span class="p">:</span> <span class="mi">6339</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;promptTokensDetails&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;modality&#34;</span><span class="p">:</span> <span class="s2">&#34;TEXT&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;tokenCount&#34;</span><span class="p">:</span> <span class="mi">6339</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;thoughtsTokenCount&#34;</span><span class="p">:</span> <span class="mi">2541</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;totalTokenCount&#34;</span><span class="p">:</span> <span class="mi">10023</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://yplam.com/tags/machinelearning/">MachineLearning</a></li>
      <li><a href="https://yplam.com/tags/flutter/">Flutter</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://yplam.com/">YPLAM</a></span> · 

    <a href="https://creativecommons.org/licenses/by-sa/4.0/">
        CC BY-SA 4.0
    </a>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
